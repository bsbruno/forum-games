{"ast":null,"code":"import _objectSpread from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState}from\"react\";import api from\"../../services/api\";import*as S from\"./styled\";import{useAuth}from\"../../hooks/AuthContext\";import{Container}from\"../../components/Container\";import Input from\"../../components/Input\";import Button from\"../../components/Button\";import{Form}from\"@unform/web\";import Menu from\"../../components/Menu\";import{useHistory}from\"react-router-dom\";import{FiCamera}from\"react-icons/fi\";import{useCallback}from\"react\";import*as Yup from\"yup\";import getValidationErros from\"../../utils/getValidationErros\";import Loading from\"../../components/Loading\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Edit=function Edit(){var _useAuth=useAuth(),user=_useAuth.user,updateUser=_useAuth.updateUser,signOut=_useAuth.signOut;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var formRef=useRef(null);var history=useHistory();var handleAvatarChange=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var data,_yield$api$put,userPhoto;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);data=new FormData();data.append(\"avatar\",e.target.files[0]);_context.next=5;return api.put(\"users/avatar\",data);case 5:_yield$api$put=_context.sent;userPhoto=_yield$api$put.data;_context.next=9;return updateUser(userPhoto);case 9:signOut();setLoading(false);history.push(\"/home\");case 12:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),[updateUser]);var handleSubmit=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data){var schema,name,nickname,email,password,old_password,password_confirmation,formData,_yield$api$post,userUpdate,_formRef$current,errors;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;schema=Yup.object().shape({name:Yup.string().required(\"Nome Obrigatorio\"),nickname:Yup.string().required(\"Apelido Obrigatorio\"),email:Yup.string().required().email(\"Digite um E-mail Valido\"),old_password:Yup.string(),password:Yup.string().when(\"old_password\",{is:function is(val){return!!val.length;},then:Yup.string().required(\"Campo Obrigatorio\"),otherwise:Yup.string()}),password_confirmation:Yup.string().when(\"old_password\",{is:function is(val){return!!val.length;},then:Yup.string().required(\"Campo Obrigatorio\"),otherwise:Yup.string()}).oneOf([Yup.ref(\"password\"),null],\"Senhas estão diferentes\")});_context2.next=4;return schema.validate(data,{abortEarly:false});case 4:name=data.name,nickname=data.nickname,email=data.email,password=data.password,old_password=data.old_password,password_confirmation=data.password_confirmation;setLoading(true);formData=_objectSpread({name:name,email:email,nickname:nickname},old_password?{old_password:old_password,password:password,password_confirmation:password_confirmation}:{});_context2.next=9;return api.post(\"/profile\",formData);case 9:_yield$api$post=_context2.sent;userUpdate=_yield$api$post.data;updateUser(userUpdate);setLoading(false);signOut();_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](0);if(_context2.t0 instanceof Yup.ValidationError){errors=getValidationErros(_context2.t0);(_formRef$current=formRef.current)===null||_formRef$current===void 0?void 0:_formRef$current.setErrors(errors);}case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[0,16]]);}));return function(_x2){return _ref2.apply(this,arguments);};}(),[history,updateUser]);return/*#__PURE__*/_jsxs(S.Wrapper,{children:[loading&&/*#__PURE__*/_jsx(S.ModalLoading,{children:/*#__PURE__*/_jsx(Loading,{})}),/*#__PURE__*/_jsx(Menu,{userName:user.name}),/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(S.Content,{children:[/*#__PURE__*/_jsxs(S.AvatarInput,{children:[loading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsx(\"img\",{src:user.avatar_url,alt:\"\"}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"avatar\",children:[/*#__PURE__*/_jsx(FiCamera,{}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"avatar\",onChange:handleAvatarChange})]})]}),/*#__PURE__*/_jsx(S.ProfileEdit,{children:/*#__PURE__*/_jsxs(Form,{initialData:{name:user.name,email:user.email,nickname:user.nickname},onSubmit:handleSubmit,ref:formRef,children:[/*#__PURE__*/_jsx(Input,{name:\"name\",type:\"text\",placeholder:\"Name\"}),/*#__PURE__*/_jsx(Input,{name:\"nickname\",type:\"text\",placeholder:\"Apelido\"}),/*#__PURE__*/_jsx(Input,{name:\"email\",type:\"email\",placeholder:\"E-mail\"}),/*#__PURE__*/_jsx(Input,{name:\"password\",type:\"password\",placeholder:\"Nova Senha\"}),/*#__PURE__*/_jsx(Input,{name:\"old_password\",type:\"password\",placeholder:\"Senha Atual \"}),/*#__PURE__*/_jsx(Input,{name:\"password_confirmation\",type:\"password\",placeholder:\"Confirma Senha \"}),/*#__PURE__*/_jsxs(Button,{style:{width:\"100%\"},type:\"submit\",children:[\" \",\"Salvar\",\" \"]})]})})]})})]});};export default Edit;","map":{"version":3,"sources":["C:/Users/jogos/Desktop/forum-game/frontend/src/pages/Edit/index.tsx"],"names":["React","useRef","useState","api","S","useAuth","Container","Input","Button","Form","Menu","useHistory","FiCamera","useCallback","Yup","getValidationErros","Loading","Edit","user","updateUser","signOut","loading","setLoading","formRef","history","handleAvatarChange","e","data","FormData","append","target","files","put","userPhoto","push","handleSubmit","schema","object","shape","name","string","required","nickname","email","old_password","password","when","is","val","length","then","otherwise","password_confirmation","oneOf","ref","validate","abortEarly","formData","post","userUpdate","ValidationError","errors","current","setErrors","avatar_url","width"],"mappings":"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","sourcesContent":["import React, { ChangeEvent, useRef, useState } from \"react\";\nimport api from \"../../services/api\";\nimport * as S from \"./styled\";\nimport { useAuth } from \"../../hooks/AuthContext\";\nimport { Container } from \"../../components/Container\";\nimport Input from \"../../components/Input\";\nimport Button from \"../../components/Button\";\nimport { Form } from \"@unform/web\";\nimport Menu from \"../../components/Menu\";\nimport { useHistory } from \"react-router-dom\";\nimport { FiCamera } from \"react-icons/fi\";\nimport { useCallback } from \"react\";\nimport { FormHandles } from \"@unform/core\";\nimport * as Yup from \"yup\";\nimport getValidationErros from \"../../utils/getValidationErros\";\nimport Loading from \"../../components/Loading\";\n\ntype ProfileFormData = {\n  name: string;\n  email: string;\n  old_password: string;\n  password: string;\n  password_confirmation: string;\n  nickname: string;\n};\n\nconst Edit: React.FC = () => {\n  const { user, updateUser, signOut } = useAuth();\n  const [loading, setLoading] = useState(null);\n\n  const formRef = useRef<FormHandles>(null);\n  const history = useHistory();\n\n  const handleAvatarChange = useCallback(\n    async (e: ChangeEvent<HTMLInputElement>) => {\n      setLoading(true);\n      const data = new FormData();\n      data.append(\"avatar\", e.target.files[0]);\n      const { data: userPhoto } = await api.put(\"users/avatar\", data);\n\n      await updateUser(userPhoto);\n      signOut();\n      setLoading(false);\n      history.push(\"/home\");\n    },\n    [updateUser]\n  );\n\n  const handleSubmit = useCallback(\n    async (data: ProfileFormData) => {\n      try {\n        const schema = Yup.object().shape({\n          name: Yup.string().required(\"Nome Obrigatorio\"),\n          nickname: Yup.string().required(\"Apelido Obrigatorio\"),\n          email: Yup.string().required().email(\"Digite um E-mail Valido\"),\n          old_password: Yup.string(),\n          password: Yup.string().when(\"old_password\", {\n            is: (val) => !!val.length,\n            then: Yup.string().required(\"Campo Obrigatorio\"),\n            otherwise: Yup.string(),\n          }),\n          password_confirmation: Yup.string()\n            .when(\"old_password\", {\n              is: (val) => !!val.length,\n              then: Yup.string().required(\"Campo Obrigatorio\"),\n              otherwise: Yup.string(),\n            })\n            .oneOf([Yup.ref(\"password\"), null], \"Senhas estão diferentes\"),\n        });\n\n        await schema.validate(data, {\n          abortEarly: false,\n        });\n        const {\n          name,\n          nickname,\n          email,\n          password,\n          old_password,\n          password_confirmation,\n        } = data;\n        setLoading(true);\n        const formData = {\n          name,\n          email,\n          nickname,\n          ...(old_password\n            ? { old_password, password, password_confirmation }\n            : {}),\n        };\n        const { data: userUpdate } = await api.post(\"/profile\", formData);\n        updateUser(userUpdate);\n        setLoading(false);\n        signOut();\n      } catch (err) {\n        if (err instanceof Yup.ValidationError) {\n          const errors = getValidationErros(err);\n          formRef.current?.setErrors(errors);\n        }\n      }\n    },\n    [history, updateUser]\n  );\n\n  return (\n    <S.Wrapper>\n      {loading && (\n        <S.ModalLoading>\n          <Loading />\n        </S.ModalLoading>\n      )}\n      <Menu userName={user.name} />\n      <Container>\n        <S.Content>\n          <S.AvatarInput>\n            {loading ? <Loading /> : <img src={user.avatar_url} alt=\"\" />}\n            <label htmlFor=\"avatar\">\n              <FiCamera />\n              <input type=\"file\" id=\"avatar\" onChange={handleAvatarChange} />\n            </label>\n          </S.AvatarInput>\n          <S.ProfileEdit>\n            <Form\n              initialData={{\n                name: user.name,\n                email: user.email,\n                nickname: user.nickname,\n              }}\n              onSubmit={handleSubmit}\n              ref={formRef}\n            >\n              <Input name=\"name\" type=\"text\" placeholder=\"Name\" />\n              <Input name=\"nickname\" type=\"text\" placeholder=\"Apelido\" />\n              <Input name=\"email\" type=\"email\" placeholder=\"E-mail\" />\n              <Input name=\"password\" type=\"password\" placeholder=\"Nova Senha\" />\n              <Input\n                name=\"old_password\"\n                type=\"password\"\n                placeholder=\"Senha Atual \"\n              />\n              <Input\n                name=\"password_confirmation\"\n                type=\"password\"\n                placeholder=\"Confirma Senha \"\n              />\n              <Button style={{ width: \"100%\" }} type=\"submit\">\n                {\" \"}\n                Salvar{\" \"}\n              </Button>\n            </Form>\n          </S.ProfileEdit>\n        </S.Content>\n      </Container>\n    </S.Wrapper>\n  );\n};\n\nexport default Edit;\n"]},"metadata":{},"sourceType":"module"}