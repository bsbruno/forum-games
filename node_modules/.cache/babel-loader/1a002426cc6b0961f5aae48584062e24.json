{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useState}from\"react\";import Menu from\"../../components/Menu\";import{useAuth}from\"../../hooks/AuthContext\";import Button from\"../../components/Button\";import*as S from\"./styled\";import{Container}from\"../../components/Container\";import api from\"../../services/api\";import CardShowContainer from\"../../components/CardPostShow\";import{useEffect}from\"react\";import{AiFillCloseCircle}from\"react-icons/ai\";import{useHistory}from\"react-router-dom\";import{Form}from\"@unform/web\";import Loading from\"../../components/Loading\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),open=_useState2[0],setIsOpen=_useState2[1];var _useAuth=useAuth(),user=_useAuth.user;var history=useHistory();var total=5;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),post=_useState4[0],setPost=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),postText=_useState6[0],setPostText=_useState6[1];var _useState7=useState([total]),_useState8=_slicedToArray(_useState7,2),page=_useState8[0],setPage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),infinite=_useState12[0],setInfinite=_useState12[1];console.log(page);function handlePost(){return _handlePost.apply(this,arguments);}function _handlePost(){_handlePost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);_context2.next=3;return api.get(\"/post\",{params:{limit:page}});case 3:response=_context2.sent;if(response&&response.status===204&&response.data<total){setInfinite(false);}setPost(response.data);setLoading(false);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _handlePost.apply(this,arguments);}useEffect(function(){handlePost();},[infinite,page]);useEffect(function(){function infiniteScroll(){if(infinite){var scroll=window.scrollY;var heigth=document.body.offsetHeight-window.innerHeight;if(scroll>heigth*0.75){setPage(function(pages){return[].concat(_toConsumableArray(pages),[pages.length+3]);});}}}window.addEventListener(\"wheel\",infiniteScroll);window.addEventListener(\"scroll\",infiniteScroll);return function(){window.removeEventListener(\"wheel\",infiniteScroll);window.removeEventListener(\"scroll\",infiniteScroll);};},[page,infinite,setInfinite]);var handlePostSubmit=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return api.post(\"/post\",{post_text:postText});case 2:setPostText(\" \");setIsOpen(false);history.go(0);case 5:case\"end\":return _context.stop();}}},_callee);})),[post,postText]);return/*#__PURE__*/_jsxs(S.Wrapper,{children:[/*#__PURE__*/_jsx(Menu,{userName:user.name}),/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsxs(S.PostContainer,{children:[/*#__PURE__*/_jsx(S.ProfileContainer,{children:/*#__PURE__*/_jsx(\"img\",{src:user.avatar_url})}),/*#__PURE__*/_jsx(S.PostInput,{onClick:function onClick(){return setIsOpen(true);},children:/*#__PURE__*/_jsx(\"textarea\",{name:\"post\",placeholder:\"Diga o que est\\xE1 pensando,\".concat(user.name),rows:1,cols:60,maxLength:150,value:postText,readOnly:true})})]}),/*#__PURE__*/_jsx(S.CardContainer,{children:post.map(function(post,index){return/*#__PURE__*/_jsx(CardShowContainer,{url_post:\"/post/v1/\".concat(post.id),nickName:post.user.nickname,text_post:post.post_text,profile_image:\"https://app-post.s3.us-east-2.amazonaws.com/\".concat(post.user.avatar)},index);})}),/*#__PURE__*/_jsx(S.ModalContent,{open:open,children:/*#__PURE__*/_jsxs(S.PosterTextModal,{children:[/*#__PURE__*/_jsxs(S.ProfileModalContainer,{children:[/*#__PURE__*/_jsx(\"img\",{src:user.avatar_url}),/*#__PURE__*/_jsxs(\"span\",{children:[\" \",user.name,\" \"]})]}),/*#__PURE__*/_jsxs(S.PostModal,{children:[/*#__PURE__*/_jsxs(Form,{onSubmit:handlePostSubmit,children:[/*#__PURE__*/_jsx(\"textarea\",{name:\"\",id:\"\",placeholder:\"Diga o que est\\xE1 pensando,\".concat(user.name),onChange:function onChange(e){return setPostText(e.target.value);}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",children:\"Postar\"})]}),/*#__PURE__*/_jsx(S.CloseModal,{onClick:function onClick(){return setIsOpen(false);},children:/*#__PURE__*/_jsx(AiFillCloseCircle,{size:30})})]})]})}),loading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsx(S.LoadContent,{children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uD83D\\uDE05 Parece que n\\xE3o tem mais posts \\uD83D\\uDE05\"})})]})]});};export default Home;","map":{"version":3,"sources":["C:/Users/jogos/Desktop/forum-game/frontend/src/pages/Home/index.tsx"],"names":["React","useCallback","useState","Menu","useAuth","Button","S","Container","api","CardShowContainer","useEffect","AiFillCloseCircle","useHistory","Form","Loading","Home","open","setIsOpen","user","history","total","post","setPost","postText","setPostText","page","setPage","loading","setLoading","infinite","setInfinite","console","log","handlePost","get","params","limit","response","status","data","infiniteScroll","scroll","window","scrollY","heigth","document","body","offsetHeight","innerHeight","pages","length","addEventListener","removeEventListener","handlePostSubmit","post_text","go","name","avatar_url","map","index","id","nickname","avatar","e","target","value"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from \"react\";\nimport Menu from \"../../components/Menu\";\nimport { useAuth } from \"../../hooks/AuthContext\";\nimport Button from \"../../components/Button\";\nimport * as S from \"./styled\";\nimport { Container } from \"../../components/Container\";\nimport api from \"../../services/api\";\nimport CardShowContainer from \"../../components/CardPostShow\";\nimport { useEffect } from \"react\";\nimport { AiFillCloseCircle } from \"react-icons/ai\";\nimport { useHistory } from \"react-router-dom\";\nimport { Form } from \"@unform/web\";\nimport Loading from \"../../components/Loading\";\n\ntype PostsProps = {\n  id: string;\n  id_user: string;\n  post_text: string;\n  user: {\n    id: string;\n    avatar?: string;\n    name?: string;\n    nickname?: string;\n  };\n};\n\nconst Home: React.FC = () => {\n  const [open, setIsOpen] = useState(false);\n  const { user } = useAuth();\n  const history = useHistory();\n  const total = 5;\n  const [post, setPost] = useState<PostsProps[]>([]);\n  const [postText, setPostText] = useState(\"\");\n  const [page, setPage] = useState([total]);\n  const [loading, setLoading] = useState(false);\n  const [infinite, setInfinite] = useState(true);\n  console.log(page);\n\n  async function handlePost() {\n    setLoading(true);\n    const response = await api.get(\"/post\", {\n      params: {\n        limit: page,\n      },\n    });\n    if (response && response.status === 204 && response.data < total) {\n      setInfinite(false);\n    }\n    setPost(response.data);\n    setLoading(false);\n  }\n\n  useEffect(() => {\n    handlePost();\n  }, [infinite, page]);\n\n  useEffect(() => {\n    function infiniteScroll() {\n      if (infinite) {\n        const scroll = window.scrollY;\n        const heigth = document.body.offsetHeight - window.innerHeight;\n        if (scroll > heigth * 0.75) {\n          setPage((pages) => [...pages, pages.length + 3]);\n        }\n      }\n    }\n\n    window.addEventListener(\"wheel\", infiniteScroll);\n    window.addEventListener(\"scroll\", infiniteScroll);\n\n    return () => {\n      window.removeEventListener(\"wheel\", infiniteScroll);\n      window.removeEventListener(\"scroll\", infiniteScroll);\n    };\n  }, [page, infinite, setInfinite]);\n\n  const handlePostSubmit = useCallback(async () => {\n    await api.post(\"/post\", {\n      post_text: postText,\n    });\n    setPostText(\" \");\n    setIsOpen(false);\n\n    history.go(0);\n  }, [post, postText]);\n\n  return (\n    <S.Wrapper>\n      <Menu userName={user.name} />\n      <Container>\n        <S.PostContainer>\n          <S.ProfileContainer>\n            <img src={user.avatar_url} />\n          </S.ProfileContainer>\n          <S.PostInput onClick={() => setIsOpen(true)}>\n            <textarea\n              name=\"post\"\n              placeholder={`Diga o que está pensando,${user.name}`}\n              rows={1}\n              cols={60}\n              maxLength={150}\n              value={postText}\n              readOnly={true}\n            ></textarea>\n          </S.PostInput>\n        </S.PostContainer>\n\n        <S.CardContainer>\n          {post.map((post, index) => (\n            <CardShowContainer\n              key={index}\n              url_post={`/post/v1/${post.id}`}\n              nickName={post.user.nickname}\n              text_post={post.post_text}\n              profile_image={`https://app-post.s3.us-east-2.amazonaws.com/${post.user.avatar}`}\n            />\n          ))}\n        </S.CardContainer>\n\n        <S.ModalContent open={open}>\n          <S.PosterTextModal>\n            <S.ProfileModalContainer>\n              <img src={user.avatar_url} />\n              <span> {user.name} </span>\n            </S.ProfileModalContainer>\n            <S.PostModal>\n              <Form onSubmit={handlePostSubmit}>\n                <textarea\n                  name=\"\"\n                  id=\"\"\n                  placeholder={`Diga o que está pensando,${user.name}`}\n                  onChange={(e) => setPostText(e.target.value)}\n                ></textarea>\n                <Button type=\"submit\">Postar</Button>\n              </Form>\n              <S.CloseModal onClick={() => setIsOpen(false)}>\n                <AiFillCloseCircle size={30} />\n              </S.CloseModal>\n            </S.PostModal>\n          </S.PosterTextModal>\n        </S.ModalContent>\n        {loading ? (\n          <Loading />\n        ) : (\n          <S.LoadContent>\n            <p>😅 Parece que não tem mais posts 😅</p>\n          </S.LoadContent>\n        )}\n      </Container>\n    </S.Wrapper>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}