{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/jogos/Desktop/forum-game/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext}from\"react\";import{useContext}from\"react\";import{useCallback}from\"react\";import{useState}from\"react\";import api from\"../services/api\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext({});export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){var token=localStorage.getItem(\"@Posts:token\");var user=localStorage.getItem(\"@Posts:user\");if(token&&user){api.defaults.headers.authorization=\"Bearer \".concat(token);return{token:token,user:JSON.parse(user)};}return{};}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var signIn=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2){var email,password,response,_response$data,token,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:email=_ref2.email,password=_ref2.password;_context.next=3;return api.post(\"sessions\",{email:email,password:password});case 3:response=_context.sent;_response$data=response.data,token=_response$data.token,user=_response$data.user;localStorage.setItem(\"@Posts:token\",token);localStorage.setItem(\"@Posts:user\",JSON.stringify(user));api.defaults.headers.authorization=\"Bearer \".concat(token);setData({token:token,user:user});case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref3.apply(this,arguments);};}(),[]);var updateUser=useCallback(function(user){localStorage.setItem(\"@Posts:user\",JSON.stringify(user));setData({token:data.token,user:user});},[setData,data.token]);var signOut=useCallback(function(){localStorage.removeItem(\"@Posts:token\");localStorage.removeItem(\"@Posts:user\");setData({});},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user:data.user,signIn:signIn,signOut:signOut,updateUser:updateUser},children:children});};export function useAuth(){var context=useContext(AuthContext);if(!context)throw new Error(\"useAuth must be used within an AuthProvider\");return context;}","map":{"version":3,"sources":["C:/Users/jogos/Desktop/forum-game/frontend/src/hooks/AuthContext.tsx"],"names":["React","createContext","useContext","useCallback","useState","api","AuthContext","AuthProvider","children","token","localStorage","getItem","user","defaults","headers","authorization","JSON","parse","data","setData","signIn","email","password","post","response","setItem","stringify","updateUser","signOut","removeItem","useAuth","context","Error"],"mappings":"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","sourcesContent":["import React, { createContext } from \"react\";\nimport { useContext } from \"react\";\nimport { useCallback } from \"react\";\nimport { useState } from \"react\";\nimport api from \"../services/api\";\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n  avatar: string;\n  nickname: string;\n  avatar_url: string;\n}\ninterface AuthState {\n  token: string;\n  user: User;\n}\n\ninterface SignInCredentials {\n  email: string;\n  password: string;\n}\n\ninterface AuthContextData {\n  user: User;\n  signOut(): void;\n  signIn(credentials: SignInCredentials): Promise<void>;\n  updateUser(user: User): void;\n}\n\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\n\nexport const AuthProvider: React.FC = ({ children }) => {\n  const [data, setData] = useState<AuthState>(() => {\n    const token = localStorage.getItem(\"@Posts:token\");\n    const user = localStorage.getItem(\"@Posts:user\");\n\n    if (token && user) {\n      api.defaults.headers.authorization = `Bearer ${token}`;\n      return { token, user: JSON.parse(user) };\n    }\n    return {} as AuthState;\n  });\n\n  const signIn = useCallback(async ({ email, password }) => {\n    const response = await api.post(\"sessions\", { email, password });\n\n    const { token, user } = response.data;\n    localStorage.setItem(\"@Posts:token\", token);\n    localStorage.setItem(\"@Posts:user\", JSON.stringify(user));\n\n    api.defaults.headers.authorization = `Bearer ${token}`;\n    setData({ token, user });\n  }, []);\n\n  const updateUser = useCallback(\n    (user: User) => {\n      localStorage.setItem(\"@Posts:user\", JSON.stringify(user));\n\n      setData({\n        token: data.token,\n        user,\n      });\n    },\n    [setData, data.token]\n  );\n  const signOut = useCallback(() => {\n    localStorage.removeItem(\"@Posts:token\");\n    localStorage.removeItem(\"@Posts:user\");\n    setData({} as AuthState);\n  }, []);\n\n  return (\n    <AuthContext.Provider\n      value={{ user: data.user, signIn, signOut, updateUser }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport function useAuth(): AuthContextData {\n  const context = useContext(AuthContext);\n  if (!context) throw new Error(\"useAuth must be used within an AuthProvider\");\n\n  return context;\n}\n"]},"metadata":{},"sourceType":"module"}